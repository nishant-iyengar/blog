module.exports=[50602,a=>{"use strict";let b,c;var d=a.i(18925),e=a.i(22785),f=a.i(15055);function g(a,b,c){if(!b(a))throw Error(c);return a}function h(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function i(a){return"number"==typeof a&&!isNaN(a)}function j(a,b){return!!Array.isArray(a)&&(!b||a.every(b))}function k(a){return Array.isArray(a)&&a.length>0&&a.every(a=>Array.isArray(a)&&a.every(a=>"number"==typeof a&&!isNaN(a)))}function l(a){return a instanceof Error}function m(a,b,c){return!!h(a)&&b in a&&c(a[b])}function n(a,b,c){let d;if("string"==typeof a)try{d=JSON.parse(a)}catch{throw Error(`Invalid JSON: ${c}`)}else try{let b=JSON.stringify(a);d=JSON.parse(b)}catch{throw Error(`Failed to serialize: ${c}`)}return g(d,b,c)}let o=new Set(["arrowup","arrowdown","arrowleft","arrowright"," ","w","a","s","d","q","p"]);function p(a){let b=(0,e.useRef)(new Set),[c,d]=(0,e.useState)(!1),f=(0,e.useRef)(a?.gameOver??!1);return(0,e.useEffect)(()=>{f.current=a?.gameOver??!1},[a?.gameOver]),(0,e.useEffect)(()=>{let a=a=>{let c;if(!f.current){if(" "===a.key||"Space"===a.code)c=" ";else if(a.key.startsWith("Arrow")||a.code.startsWith("Arrow")){let b=a.key.replace("Arrow","").toLowerCase()||a.code.replace("Arrow","").toLowerCase();c=`arrow${b}`}else c=a.code.startsWith("Key")?a.code.replace("Key","").toLowerCase():a.key.toLowerCase();if(o.has(c)){if(a.preventDefault(),a.stopPropagation(),"p"===c)return void d(a=>!a);b.current.add(c)}}},c=a=>{let c;if(!f.current){if(" "===a.key||"Space"===a.code)c=" ";else if(a.key.startsWith("Arrow")||a.code.startsWith("Arrow")){let b=a.key.replace("Arrow","").toLowerCase()||a.code.replace("Arrow","").toLowerCase();c=`arrow${b}`}else c=a.code.startsWith("Key")?a.code.replace("Key","").toLowerCase():a.key.toLowerCase();o.has(c)&&(a.preventDefault(),a.stopPropagation(),"p"!==c&&b.current.delete(c))}};return window.addEventListener("keydown",a,!0),window.addEventListener("keyup",c,!0),()=>{window.removeEventListener("keydown",a,!0),window.removeEventListener("keyup",c,!0)}},[]),{keysRef:b,isPaused:c}}function q(){let[a,b]=(0,e.useState)({blue:null,red:null});return(0,e.useEffect)(()=>{let a=new Image;a.src="/games/tank-blue.svg",a.onload=()=>{b(b=>({...b,blue:a}))};let c=new Image;c.src="/games/tank-red.svg",c.onload=()=>{b(a=>({...a,red:c}))}},[]),a}let r=24,s=10,t=1.4,u=5,v=3,w=2,x=1.8,y=5,z=7e3,A=500,B=3,C=72,D=150,E=.25,F=120,G=60,H=2,I=2,J=3,K=3,L=-3,M=7,N=4,O=10,P=!0,Q=r,R=s,S=Q/2,T=t,U=T*x,V=u,W=1e3/C,X=y,Y=z,Z=E,$=F,_=G;function aa(a,b,c,d,e,f,g,h){return a<e+g&&a+c>e&&b<f+h&&b+d>f}function ab(a,b,c,d){let e=a.x,f=a.y,g=b.x,h=b.y,i=!1,j=e-0<d.left,k=e+0>d.right,l=f-0<d.top,m=f+0>d.bottom;return(j||k)&&(l||m)?(j?(e=d.left+0,g=-g):k&&(e=d.right-0,g=-g),l?(f=d.top+0,h=-h):m&&(f=d.bottom-0,h=-h),i=!0):(j?(e=d.left+0,g=-g,i=!0):k&&(e=d.right-0,g=-g,i=!0),l?(f=d.top+0,h=-h,i=!0):m&&(f=d.bottom-0,h=-h,i=!0)),{newPosition:{x:e,y:f},newVelocity:{x:g,y:h},bounced:i}}function ac(a,b,c,d,e){let f=c/2,g=a.x-f,h=a.x+f,i=a.y-f,j=a.y+f,k=b.x,l=b.y,m=!1;if(g<d.x+d.width&&h>d.x&&i<d.y+d.height&&j>d.y){let b=e?.x??a.x,c=e?.y??a.y,g=Math.abs(b-d.x),h=Math.abs(b-(d.x+d.width)),i=Math.abs(c-d.y),j=Math.abs(c-(d.y+d.height)),n=Math.min(g,h,i,j),o=a.x,p=a.y;return n===g?(k=-k,o=d.x-f,m=!0):n===h?(k=-k,o=d.x+d.width+f,m=!0):n===i?(l=-l,p=d.y-f,m=!0):n===j&&(l=-l,p=d.y+d.height+f,m=!0),{newPosition:{x:o,y:p},newVelocity:{x:k,y:l},bounced:m}}return{newPosition:{x:a.x,y:a.y},newVelocity:{x:k,y:l},bounced:!1}}function ad(a,b,c){let d=0,e=0,f=c.influenceRadius*c.influenceRadius;for(let g of b){let b=g.x-a.x,h=g.y-a.y,i=b*b+h*h;if(i>=f||0===i)continue;let j=function(a,b,c){let d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;if(f>=c.influenceRadius*c.influenceRadius||0===f)return{x:0,y:0};let g=Math.sqrt(f),h=Math.max(g,c.minDistance),i=c.gravitationalConstant*c.sourceMass/(h*h);return void 0!==c.maxAcceleration&&(i=Math.min(i,c.maxAcceleration)),{x:d/g*i,y:e/g*i}}(a,g,c);d+=j.x,e+=j.y}return{x:d,y:e}}function ae(a,b){let c=Math.sqrt(a.x*a.x+a.y*a.y);if(c<b&&c>0){let d=b/c;return{x:a.x*d,y:a.y*d}}return a}let af=Math.PI/180,ag=180/Math.PI;function ah(a,b,c,d,e,f,g,h){let i=(Q-R)/2,j=a+i,k=b+i;if(j<-.001||k<-.001||j+R>c+.001||k+R>d+.001)return!1;for(let a of e)if(aa(j,k,R,R,a.x,a.y,a.width,a.height))return!1;for(let a of g){let b=a.x-a.size,c=a.x+a.size,d=a.y-a.size;if(aa(j,k,R,R,b,d,c-b,a.y+a.size-d))return!1}return!0}function ai(a,b,c,d){let e=c-a,f=d-b;return Math.sqrt(e*e+f*f)}function aj(a,b){return ai(a.x,a.y,b.x,b.y)}function ak(a){for(;a>180;)a-=360;for(;a<-180;)a+=360;return a}function al(a,b){let c=b.x-a.x;return Math.atan2(b.y-a.y,c)*ag}function am(a,b,c,d){let e=b*af;return{x:a.x+Q/2+Math.cos(e)*(Q/2+w),y:a.y+Q/2+Math.sin(e)*(Q/2+w),angle:b,speed:U,owner:d,createdAt:c,vx:Math.cos(e)*U,vy:Math.sin(e)*U}}function an(a){return{x:a.x+S,y:a.y+S}}function ao(a,b,c,d){let e=(Q-R)/2;return{x:Math.max(-e,Math.min(a,c-Q+e)),y:Math.max(-e,Math.min(b,d-Q+e))}}function ap(a){let b=new Map;for(let c of a)c.exploding||b.set(c.owner,(b.get(c.owner)||0)+1);return b}function aq(a){return function(a,b,c){let{tank:d,keys:e,tickTime:f,lastShotTime:g,bullets:h,mapWidth:i,mapHeight:j,barriers:k,suns:l,allTanks:m,tankIndex:n}=a,o=d.angle,p=d.x,q=d.y,r=[],s=g;if(e.has(b.rotateLeft)&&(o-=V),e.has(b.rotateRight)&&(o+=V),e.has(b.moveForward)){let a=o*af,b=p+Math.cos(a)*T,c=q+Math.sin(a)*T;ah(b,c,i,j,k,m,l,n)&&(p=b,q=c)}if(e.has(b.moveBackward)){let a=o*af,b=p+-Math.cos(a)*T,c=q+-Math.sin(a)*T;ah(b,c,i,j,k,m,l,n)&&(p=b,q=c)}if(e.has(b.shoot)&&f-g>D&&(ap(h).get(c)||0)<X){let a=am({...d,x:p,y:q,angle:o},o,f,c);r.push(a),s=f}let t=ao(p,q,i,j);return{updatedTank:{...d,x:t.x,y:t.y,angle:o},newBullets:r,lastShotTime:s}}(a,{rotateLeft:"arrowleft",rotateRight:"arrowright",moveForward:"arrowup",moveBackward:"arrowdown",shoot:" "},"blue")}let ar=null,as=null,at=null,au=null,av=null;function aw(a,b,c,d,e){if(!a||"number"!=typeof a.width||"number"!=typeof a.height)return{x:90,y:90,angle:0};let f=a.width,g=a.height,h=f-Q-16,i=g-Q-16;if(isNaN(h)||isNaN(i)||h<=0||i<=0)return a.spawnPoints&&a.spawnPoints.length>0?{x:a.spawnPoints[0].x,y:a.spawnPoints[0].y,angle:a.spawnPoints[0].angle}:{x:8,y:8,angle:0};for(let f=0;f<100;f++){let f=8+Math.random()*h,g=8+Math.random()*i;if(!(e&&50>aj({x:f,y:g},e))&&ah(f,g,a.width,a.height,b,c,d))return{x:f,y:g,angle:360*Math.random()}}let j=a.spawnPoints;if(!j||0===j.length)return{x:8,y:8,angle:0};for(let f of j)if(ah(f.x,f.y,a.width,a.height,b,c,d)){if(e&&50>aj(f,e))continue;return{x:f.x,y:f.y,angle:f.angle}}return{x:j[0].x,y:j[0].y,angle:j[0].angle}}function ax(a,b,c){let d=aw(a,b||[],[],c||[]);("number"!=typeof d.x||"number"!=typeof d.y||isNaN(d.x)||isNaN(d.y))&&(d.x=90,d.y=90,d.angle=0);let e=aw(a,b,[{x:d.x,y:d.y,angle:d.angle,lives:v,color:"blue"}],c,d);return("number"!=typeof e.x||"number"!=typeof e.y||isNaN(e.x)||isNaN(e.y))&&(e.x=a.spawnPoints&&a.spawnPoints.length>1?a.spawnPoints[1].x:390,e.y=a.spawnPoints&&a.spawnPoints.length>1?a.spawnPoints[1].y:270,e.angle=a.spawnPoints&&a.spawnPoints.length>1?a.spawnPoints[1].angle:180),[{x:d.x,y:d.y,angle:d.angle,lives:v,color:"blue",exploding:void 0,explosionStartTime:void 0,respawning:void 0,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0},{x:e.x,y:e.y,angle:e.angle,lives:v,color:"red",exploding:void 0,explosionStartTime:void 0,respawning:void 0,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0}]}function ay(a,b,c,d,e,f,g=W){let h=[],i=a.x,j=a.y,k=a.vx,l=a.vy,m=0,n=B,o=!1,p=P?[]:b.map(a=>({x:a.x,y:a.y})),q={gravitationalConstant:Z,sourceMass:$,influenceRadius:_,minDistance:H,maxAcceleration:.3*U};for(h.push({x:i,y:j,time:m});m<f&&!o;){let a=P?{x:0,y:0}:ad({x:i,y:j},p,q),b=k+a.x,f=l+a.y,r=ae({x:b,y:f},.5);b=r.x,f=r.y;let s=i+b,t=j+f,u=ab({x:s,y:t},{x:b,y:f},n,{left:0,right:d,top:0,bottom:e});for(let a of(u.bounced&&(s=u.newPosition.x,t=u.newPosition.y,b=u.newVelocity.x,f=u.newVelocity.y),c)){let c=ac({x:s,y:t},{x:b,y:f},n,{x:a.x,y:a.y,width:a.width,height:a.height},{x:i,y:j});c.bounced&&(s=c.newPosition.x,t=c.newPosition.y,b=c.newVelocity.x,f=c.newVelocity.y)}if(i=s,j=t,k=b,l=f,m+=g,(0===h.length||m-h[h.length-1].time>=5*g)&&h.push({x:i,y:j,time:m}),.5>Math.sqrt(b*b+f*f)){o=!0;break}}return{points:h,isBlocked:o,endTime:m}}var az=a.i(68747);let aA=az.default.rl.action.numDiscreteActions,aB=az.default.rl.action.actions;aB.map(a=>[a.id,a]),aB.map(a=>[a.name,a]),aB.length!==aA&&console.warn(`Warning: Action definitions count (${aB.length}) doesn't match NUM_DISCRETE_ACTIONS (${aA}) in config`);for(let a=0;a<aB.length;a++)aB[a].id!==a&&console.warn(`Warning: Action at index ${a} has ID ${aB[a].id}, expected ${a}`);let aC=null,aD=null;function aE(a){let{aiTank:b,enemyTank:c,bullets:d,suns:e,barriers:f,mapWidth:g,mapHeight:h}=a,i=[];i.push(aF(b.x,0,g)),i.push(aF(b.y,0,h)),i.push(aG(b.angle)),i.push(aF(b.lives,0,3)),i.push(aF(c.x,0,g)),i.push(aF(c.y,0,h)),i.push(aG(c.angle)),i.push(aF(c.lives,0,3));let j=c.x-b.x,k=c.y-b.y,l=Math.sqrt(j*j+k*k),m=Math.sqrt(g*g+h*h);i.push(aF(j,-g,g)),i.push(aF(k,-h,h)),i.push(aF(l,0,m));let n=function(a){for(;a>180;)a-=360;for(;a<-180;)a+=360;return a/180}(180*Math.atan2(k,j)/Math.PI-b.angle);i.push(n);let o=[];for(let a=0;a<d.length&&o.length<20;a++){let b=d[a];b.exploding||o.push(b)}for(let a=0;a<20;a++)if(a<o.length){let c=o[a];i.push(aF(c.x,0,g)),i.push(aF(c.y,0,h)),i.push(aF(c.vx,-(2*U),2*U)),i.push(aF(c.vy,-(2*U),2*U)),i.push(+(c.owner===b.color))}else i.push(0,0,0,0,0);let p=(e||[]).slice(0,10);for(let a=0;a<10;a++)if(a<p.length){let b=p[a];i.push(aF(b.x,0,g)),i.push(aF(b.y,0,h)),i.push(aF(b.size,0,100))}else i.push(0,0,0);let q=function(a,b,c,d,e){let f=((null===aC||aD!==c)&&(aC=c.map(a=>({left:a.x,right:a.x+a.width,top:a.y,bottom:a.y+a.height})),aD=c),aC),g=Math.max(d,e);return[{dx:1,dy:0},{dx:1,dy:1},{dx:0,dy:1},{dx:-1,dy:1},{dx:-1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}].map(c=>{let h=0;for(;h<g;){let g=a+c.dx*h,i=b+c.dy*h;if(g<0||g>d||i<0||i>e)break;let j=!1;for(let a of f)if(g>=a.left&&g<=a.right&&i>=a.top&&i<=a.bottom){j=!0;break}if(j)break;h+=5}return h})}(b.x+Q/2,b.y+Q/2,f,g,h);return i.push(...q.map(a=>aF(a,0,Math.max(g,h)))),i.push(aF(a.tickTime%1e4,0,1e4)),i.push(aF(g,0,2e3)),{vector:i,size:i.length}}function aF(a,b,c){return c===b?.5:Math.max(0,Math.min(1,(a-b)/(c-b)))}function aG(a){let b=a%360;return b<0&&(b+=360),b/360}class aH{loaded=!0;isLoaded(){return this.loaded}async load(a){this.loaded=!0}async predict(a,b){a.vector[4],a.vector[5];let c=a.vector[11],d=0,e=0,f=!1;return Math.abs(c)>.1&&(d=c>0?5:-5),.2>Math.abs(c)&&(e=1,f=!0),{angleDelta:d,moveDirection:e,shouldShoot:f}}getInfo(){return{name:"Rule-Based Fallback",type:"discrete",observationSize:152,actionSize:aA}}}class aI{loaded=!1;model=null;info;constructor(a){this.info=a}isLoaded(){return this.loaded&&null!==this.model}async load(a){try{this.loaded=!1}catch(a){throw this.loaded=!1,a}}async predict(a,b){if(!this.isLoaded())throw Error("Model not loaded");throw Error("TensorFlow.js prediction not yet implemented")}getInfo(){return this.info}}let aJ=new class{model=null;fallbackModel;constructor(){this.fallbackModel=new aH}setModel(a){this.model=a}getModel(){return this.model&&this.model.isLoaded()?this.model:this.fallbackModel}isRLActive(){return null!==this.model&&this.model.isLoaded()}async loadModel(a){if(!this.model)throw Error("No model set. Call setModel() first.");await this.model.load(a)}};async function aK(a){let{aiTank:b,enemyTank:c,bullets:d,barriers:e,suns:f,mapWidth:g,mapHeight:h,tickTime:i,config:j}=a;if(b.respawning||b.exploding||b.lives<=0)return{angleDelta:0,moveDirection:0,shouldShoot:!1};if(aJ.isRLActive())try{let c=aJ.getModel(),d=aE(a);return await c.predict(d,b.angle)}catch(a){}return function(a){let{aiTank:b,enemyTank:c,bullets:d,barriers:e,suns:f,mapWidth:g,mapHeight:h,config:i}=a,j=function(a,b,c,d,e,f,g){let h=[];for(let i of b){if(i.owner===a.color||i.exploding)continue;let b=ay(i,c,d,e,f,g,16),j=1/0,k=0,l={x:i.x,y:i.y},m=an(a),n=R+5;for(let a of b.points){let b=ai(a.x,a.y,m.x,m.y);if(b<n){j=b,k=a.time,l={x:a.x,y:a.y};break}b<j&&(j=b,k=a.time,l={x:a.x,y:a.y})}let o=3*R;if(j<o){let a=(Math.max(0,1-k/g)+Math.max(0,1-j/o))/2;h.push({bullet:i,timeToCollision:k,closestDistance:j,collisionPoint:l,threatLevel:Math.min(1,a)})}}return h.sort((a,b)=>b.threatLevel-a.threatLevel),h}(b,d,f,e,g,h,i.maxPredictionTime);return j.length>0&&j[0].threatLevel>.85?function(a,b){let{aiTank:c,enemyTank:d,barriers:e,suns:f,mapWidth:g,mapHeight:h,config:i,bullets:j}=a,k=function(a,b,c,d,e,f){if(0===b.length)return{angle:a.angle,urgency:0};let g=b[0];if(g.threatLevel<.5)return{angle:a.angle,urgency:g.threatLevel};let h=an(a);return 1>ai(h.x,h.y,g.collisionPoint.x,g.collisionPoint.y)?{angle:(a.angle+90)%360,urgency:1}:{angle:al(g.collisionPoint,h),urgency:g.threatLevel}}(c,b,0,0,0,0),l=function a(b,c,d,e,f,g,h,i,j){let k=c*Math.PI/180,l=b.x+Math.cos(k)*d,m=b.y+Math.sin(k)*d;if(ah(l,m,h,i,e,g,f,j))return{x:l,y:m};for(let a of[(c+90)%360,(c-90+360)%360]){let c=a*Math.PI/180,k=b.x+Math.cos(c)*d,l=b.y+Math.sin(c)*d;if(ah(k,l,h,i,e,g,f,j))return{x:k,y:l}}return d>20?a(b,c,.5*d,e,f,g,h,i,j):null}(c,k.angle,2*i.dodgeMargin,e,f,[c,d],g,h,1),m=0,n=0;if(l){let a=ak(al(an(c),l)-c.angle);m=Math.abs(a)>V?a>0?V:-V:a,n=1}else{let a=ak(k.angle-c.angle);m=Math.abs(a)>V?a>0?V:-V:a,n=-1}return{angleDelta:m,moveDirection:n,shouldShoot:!1}}(a,j):function(a){let b,c,d,e,{aiTank:f,enemyTank:g,bullets:h,barriers:i,suns:j,mapWidth:k,mapHeight:l,tickTime:m,config:n}=a,o=function(a,b,c,d,e,f,g){let h=180*Math.atan2(b.y-(a.y+Q/2),b.x-(a.x+Q/2))/Math.PI,i=h*Math.PI/180,j=ay({x:a.x+Q/2+Math.cos(i)*(Q/2+w),y:a.y+Q/2+Math.sin(i)*(Q/2+w),angle:h,speed:U,owner:a.color,createdAt:0,vx:Math.cos(i)*U,vy:Math.sin(i)*U},c,d,e,f,3e3,W),k=0;for(let a of j.points){let c=a.x-b.x,d=a.y-b.y;if(15>Math.sqrt(c*c+d*d)){k=.8;break}}let l=function(a,b,c,d,e,f,g){if(g<.3||0===c.length)return null;let h=null,i=0;for(let j of c)for(let j=0;j<16;j++){let k=180*Math.atan2(b.y-(a.y+Q/2),b.x-(a.x+Q/2))/Math.PI+(j/15-.5)*60,l=k*Math.PI/180,m=ay({x:a.x+Q/2+Math.cos(l)*(Q/2+w),y:a.y+Q/2+Math.sin(l)*(Q/2+w),angle:k,speed:U,owner:a.color,createdAt:0,vx:Math.cos(l)*U,vy:Math.sin(l)*U},c,d,e,f,3e3,W),n=1/0,o=0;for(let a of m.points){let c=a.x-b.x,d=a.y-b.y,e=Math.sqrt(c*c+d*d);if(e<n&&(n=e,o=a.time),e<15){let a=g*(1-Math.min(n/30,1));a>i&&(i=a,h={angle:k,confidence:a,timeToHit:o,usesSun:!0})}}}return h}(a,b,c,d,e,f,g);return l&&l.confidence>k?l:{angle:h,confidence:k,timeToHit:1e3,usesSun:!1}}(f,(d=Math.cos(c=g.angle*Math.PI/180)*T*(500/W),e=Math.sin(c)*T*(500/W),{x:g.x+d,y:g.y+e}),j,i,k,l,n.sunSkill);!function(a,b,c,d,e,f,g){let h=a.x+12,i=a.y+12,j=b.x+12,k=b.y+12,l=j-h,m=k-i,n=Math.sqrt(l*l+m*m),o=180*Math.atan2(m,l)/Math.PI,p=j,q=k;if(n>30){let a=Math.min(.8*n,50+(1-c)*50);p=j-Math.cos(o*Math.PI/180)*a,q=k-Math.sin(o*Math.PI/180)*a}else p=h,q=i;let r=(p=Math.max(12,Math.min(p,f-12)))-h;q=Math.max(12,Math.min(q,g-12))}(f,g,n.aggressiveness,0,0,k,l);let p=0,q=0,r=ak(o.angle-f.angle);p=Math.abs(r)>V?r>0?V:-V:r;let s=ak(al(an(f),an(g))-f.angle);q=60>Math.abs(s)?1:Math.abs(s)>120?-1:1;let t=!1;return(ap(h).get(f.color)||0)<X&&o.confidence>.2-n.accuracyPenalty&&o.confidence*(1-n.accuracyPenalty)>.15&&45>Math.abs(r)&&(t=!0,b=o.angle),{angleDelta:p,moveDirection:q,shouldShoot:t,shootAngle:b}}(a)}(a)}let aL={reactionDelay:30,accuracyPenalty:.08,aggressiveness:.85,sunSkill:.65,maxPredictionTime:3e3,dodgeMargin:25},aM={timeoutPenalty:-100,maxEpisodeTimeMs:6e4,survivalRewardPerTick:.01,hitEnemyReward:100,gotHitPenalty:-100,optimalDistanceToEnemy:120,inactivityThresholdMs:1500,significantMovementThreshold:5,aggressionCheckIntervalMs:2e3,dodgeRewardPerBullet:10,recentBulletThresholdMs:100,positionHistorySize:10,positionRepeatThreshold:30,threatDistance:50,bulletMatchDistance:10,movementAwayThreshold:10,shotAccuracyMaxDistance:50,movementRewardMax:.15,movementRewardMultiplier:.0015,stagnationPenalty:-.1,stalematePenalty:-.2,repetitiveActionPenalty:-.03,positionDiversityReward:.02,lifeAdvantageReward:.02,inactivityBasePenalty:-.3,inactivityMaxPenalty:-.5,inactivityScalingFactor:.1,lackOfAggressionPenalty:-.15};function aN(a,b){return ai(a.x,a.y,b.x,b.y)}function aO(a,b){let c=an(b);return ai(a.x,a.y,c.x,c.y)}class aP{previousState=null;episodeStartTime=0;episodeLength=0;totalReward=0;positionHistory=[];maxEpisodeTimeMs;constructor(a=6e4){this.maxEpisodeTimeMs=a}reset(a){let b=aE(a);return this.positionHistory=[{x:a.aiTank.x,y:a.aiTank.y,tickTime:a.tickTime}],this.episodeStartTime=a.tickTime,this.previousState={aiTank:{...a.aiTank},enemyTank:{...a.enemyTank},bullets:a.bullets.map(a=>({...a})),aiLives:a.aiTank.lives,enemyLives:a.enemyTank.lives,tickTime:a.tickTime,aiPositionHistory:[],lastMovementTime:a.tickTime,lastShotTime:0,episodeStartTime:a.tickTime,timeoutApplied:!1},this.episodeLength=0,this.totalReward=0,{observation:b,reward:0,done:!1,info:{episodeLength:0,totalReward:0,aiLives:a.aiTank.lives,enemyLives:a.enemyTank.lives}}}step(a,b,c){if(!this.previousState)return this.reset(b);let d=function(a,b,c,d=6e4,e=aM){let f=0,g={};if(a.episodeStartTime&&!a.timeoutApplied&&b.tickTime-a.episodeStartTime>=d){let a=e.timeoutPenalty;f+=a,g.timeoutPenalty=a}let h=e.survivalRewardPerTick;if(f+=h,g.survival=h,b.enemyLives<a.enemyLives){let a=e.hitEnemyReward;f+=a,g.hitEnemy=a}if(b.aiLives<a.aiLives){let a=e.gotHitPenalty;f+=a,g.gotHit=a}let i=aN(a.aiTank,a.enemyTank),j=aN(b.aiTank,b.enemyTank),k=e.optimalDistanceToEnemy,l=2*(Math.abs(i-k)/k-Math.abs(j-k)/k);f+=l,g.distanceReward=l;let m=function(a,b,c){let d=c.threatDistance,e=c.bulletMatchDistance,f=[];for(let b of a.bullets)b.owner!==a.aiTank.color&&!b.exploding&&aO(b,a.aiTank)<d&&f.push(b);let g=new Map;for(let a of b.bullets)if(!a.exploding){let b=g.get(a.owner)||[];b.push(a),g.set(a.owner,b)}let h=0,i=an(b.aiTank);for(let a of f){let b=g.get(a.owner)||[],c=!1;for(let d of b)if(ai(d.x,d.y,a.x,a.y)<e){c=!0;break}if(!c){let a=1/0;for(let c of b){let b=ai(c.x,c.y,i.x,i.y);b<a&&(a=b)}a>d&&h++}}return h*c.dodgeRewardPerBullet}(a,b,e);if(m>0&&(f+=m,g.dodgedBullet=m),c.shouldShoot){let a=e.recentBulletThresholdMs;for(let c of b.bullets)if(c.owner===b.aiTank.color&&b.tickTime-c.createdAt<a){let a=Math.max(0,5*(1-aO(c,b.enemyTank)/e.shotAccuracyMaxDistance));f+=a,g.shotAccuracy=(g.shotAccuracy||0)+a}}if(a.aiLives,a.enemyLives,b.aiLives-b.enemyLives>0){let a=e.lifeAdvantageReward;f+=a,g.lifeAdvantage=a}let n=aN(a.aiTank,b.aiTank),o=n>.1;if(o){let a=Math.min(e.movementRewardMax,n*e.movementRewardMultiplier);f+=a,g.movement=a}else{let a=e.stagnationPenalty;f+=a,g.stagnationPenalty=a,g.movement=a}if(5>Math.abs(aN(b.aiTank,b.enemyTank)-aN(a.aiTank,a.enemyTank))&&n<2){let a=e.stalematePenalty;f+=a,g.stalematePenalty=a}if(c.shouldShoot&&!o&&b.bullets.length>=a.bullets.length){let a=e.repetitiveActionPenalty;f+=a,g.repetitiveActionPenalty=a}if(a.aiPositionHistory&&a.aiPositionHistory.length>0){let c=e.positionRepeatThreshold,d=e.positionHistorySize,h=Math.max(0,a.aiPositionHistory.length-d),i={x:b.aiTank.x,y:b.aiTank.y},j=!1;for(let b=h;b<a.aiPositionHistory.length;b++){let d=a.aiPositionHistory[b];if(ai(i.x,i.y,d.x,d.y)<c){j=!0;break}}if(!j&&o){let a=e.positionDiversityReward;f+=a,g.movement=(g.movement||0)+a}}let p=e.inactivityThresholdMs,q=e.significantMovementThreshold;if(o&&n>=q);else{let c=a.lastMovementTime||a.episodeStartTime||a.tickTime,d=b.tickTime-c;if(d>=p){let a=Math.min(e.inactivityMaxPenalty,e.inactivityBasePenalty-(d-p)/1e3*e.inactivityScalingFactor);f+=a,g.inactivityPenalty=a}}let r=e.aggressionCheckIntervalMs,s=(a.lastShotTime?b.tickTime-a.lastShotTime:1/0)>r&&!c.shouldShoot&&n<2,t=j-i>e.movementAwayThreshold;if(s||t&&!c.shouldShoot){let a=e.lackOfAggressionPenalty;f+=a,g.lackOfAggressionPenalty=a}return{reward:f,breakdown:g}}(this.previousState,{aiTank:b.aiTank,enemyTank:b.enemyTank,bullets:b.bullets,aiLives:b.aiTank.lives,enemyLives:b.enemyTank.lives,tickTime:b.tickTime},c,this.maxEpisodeTimeMs,aM);this.totalReward+=d.reward,this.episodeLength++;let e=this.isDone(b),f=aE(b);this.positionHistory.push({x:b.aiTank.x,y:b.aiTank.y,tickTime:b.tickTime}),this.positionHistory.length>20&&this.positionHistory.shift();let g=Math.sqrt(Math.pow(b.aiTank.x-this.previousState.aiTank.x,2)+Math.pow(b.aiTank.y-this.previousState.aiTank.y,2))>=5?b.tickTime:this.previousState.lastMovementTime||b.tickTime,h=c.shouldShoot?b.tickTime:this.previousState.lastShotTime||0,i=b.tickTime-this.episodeStartTime>=this.maxEpisodeTimeMs&&!this.previousState?.timeoutApplied;return this.previousState={aiTank:{...b.aiTank},enemyTank:{...b.enemyTank},bullets:b.bullets.map(a=>({...a})),aiLives:b.aiTank.lives,enemyLives:b.enemyTank.lives,tickTime:b.tickTime,aiPositionHistory:[...this.positionHistory],lastMovementTime:g,lastShotTime:h,episodeStartTime:this.episodeStartTime,timeoutApplied:i||this.previousState?.timeoutApplied||!1},{observation:f,reward:d.reward,done:e,info:{episodeLength:this.episodeLength,totalReward:this.totalReward,aiLives:b.aiTank.lives,enemyLives:b.enemyTank.lives,...d.breakdown}}}getObservation(a){return aE(a)}isDone(a){return!!(a.aiTank.lives<=0)||!!(a.enemyTank.lives<=0)||!!(a.tickTime-this.episodeStartTime>=this.maxEpisodeTimeMs)}getStats(){return{episodeLength:this.episodeLength,totalReward:this.totalReward}}}async function aQ(a,b=aL,c,d){let e,{tank:f,tankIndex:g,tickTime:h,lastShotTime:i,bullets:j,mapWidth:k,mapHeight:l,barriers:m,suns:n,allTanks:o}=a;if(o.length>=2&&void 0!==g){let a=+(0===g);(e=o[a])&&!(e.lives<=0)||(e=o[+(0===a)]||e)}else e=o.find(a=>a&&a.color!==f.color&&a.lives>0)||o.find(a=>a&&a!==f);e||(e={x:k/2,y:l/2,angle:0,lives:3,color:"blue"===f.color?"red":"blue"});let p={aiTank:f,enemyTank:e,bullets:j,barriers:m,suns:n,mapWidth:k,mapHeight:l,tickTime:h,config:b},q=await aK(p);c&&c.getIsTraining()&&c.step(p,q,void 0,d).catch(()=>{});let r=f.angle+q.angleDelta,s=f.x,t=f.y,u=[],v=i;if(0!==q.moveDirection){let a=r*af,b=q.moveDirection>0?T:-(.7*T),c=s+Math.cos(a)*b,d=t+Math.sin(a)*b;ah(c,d,k,l,m,o,n,g)&&(s=c,t=d)}if(q.shouldShoot&&h-i>D&&(ap(j).get(f.color)||0)<X){let a=q.shootAngle??r,b=am({...f,x:s,y:t,angle:a},a,h,f.color);u.push(b),v=h}let w=ao(s,t,k,l);return s=w.x,t=w.y,{updatedTank:{...f,x:s,y:t,angle:r},newBullets:u,lastShotTime:v,decision:q}}function aR({mapData:a,barriers:b,suns:c,aiConfig:d,trainingManager:f,maxEpisodeTimeMs:g=6e4,gameInstances:h,onTanksUpdate:i,onBulletsUpdate:j,onLastShotTimesUpdate:k,onGameOver:l}){let m=(0,e.useRef)(new Map),n=(0,e.useRef)(new Map),o=(0,e.useRef)(new Map),p=(0,e.useRef)(new Map),q=(0,e.useRef)(h),r=(0,e.useRef)(new Map);return(0,e.useEffect)(()=>{q.current=h;let a=new Map;h.forEach(b=>{a.set(b.id,b)}),r.current=a},[h]),(0,e.useEffect)(()=>{h.forEach(a=>{o.current.has(a.id)||o.current.set(a.id,a.tanks),p.current.has(a.id)||p.current.set(a.id,a.bullets)})},[h]),(0,e.useEffect)(()=>{h.forEach(a=>{o.current.get(a.id),o.current.set(a.id,a.tanks),p.current.set(a.id,a.bullets),a.tanks.length>=2&&a.tanks[0]?.lives===v&&a.tanks[1]?.lives===v&&m.current.set(a.id,!1)})},[h]),{gameTick:(0,e.useCallback)(async e=>{let h,s=q.current;for(let q of e?.gameId!==void 0?(h=r.current.get(e.gameId))?[h]:[]:s){if(q.isPaused)continue;let h=Date.now(),r=n.current.get(q.id)||0;if(!e?.skipIntervalCheck&&h-r<W/q.speedMultiplier)return;n.current.set(q.id,h);let s=[...o.current.get(q.id)||[]],t=[...p.current.get(q.id)||[]],u={...q.lastShotTimes},v=q.keysRef.current;if(!s||s.length<2)continue;if(s[0]?.lives>0){let e;e="person-vs-ai"===q.gameMode?aq({tank:s[0],tankIndex:0,keys:v,tickTime:h,lastShotTime:q.lastShotTimes.blue,bullets:t,mapWidth:a.width,mapHeight:a.height,barriers:b,suns:c,allTanks:s}):f&&f.getIsTraining()&&"ai"===q.gameMode?await aQ({tank:s[0],tankIndex:0,keys:v,tickTime:h,lastShotTime:q.lastShotTimes.blue,bullets:t,mapWidth:a.width,mapHeight:a.height,barriers:b,suns:c,allTanks:s},d,f,`${q.gameId}-blue`):aq({tank:s[0],tankIndex:0,keys:v,tickTime:h,lastShotTime:q.lastShotTimes.blue,bullets:t,mapWidth:a.width,mapHeight:a.height,barriers:b,suns:c,allTanks:s}),s[0]=e.updatedTank,t.push(...e.newBullets),u.blue=e.lastShotTime}if(s[1]?.lives>0){let e=await aQ({tank:s[1],tankIndex:1,keys:v,tickTime:h,lastShotTime:q.lastShotTimes.red,bullets:t,mapWidth:a.width,mapHeight:a.height,barriers:b,suns:c,allTanks:s},d,f,q.gameId);s[1]=e.updatedTank,t.push(...e.newBullets),u.red=e.lastShotTime}let w=function(a){let b,{bullets:c,tickTime:d,mapWidth:e,mapHeight:f,barriers:g,suns:h,tanks:i}=a,j=[],k=[...i],l=B,m=function(a){let b=new Map;for(let c=0;c<a.length;c++){let d=a[c];if(d.exploding)continue;let e=b.get(d.owner)||[];e.push(c),b.set(d.owner,e)}return b}(c),n=function(a,b){let c=new Set,d=new Set,e=B,f=b.get("blue")||[],g=b.get("red")||[];for(let b of f){if(c.has(b))continue;let f=a[b];if(!f.exploding)for(let h of g){if(c.has(h))continue;let g=a[h];if(g.exploding)continue;let i=`${Math.min(b,h)}-${Math.max(b,h)}`;if(!d.has(i)&&(d.add(i),ai(f.x,f.y,g.x,g.y)<e)){c.add(b),c.add(h);break}}}return c}(c,m),o=(b=P,(null===ar||as!==h||at!==b)&&(ar=b?[]:h.map(a=>({x:a.x,y:a.y})),as=h,at=b),ar),p=((null===au||av!==U)&&(au={gravitationalConstant:Z,sourceMass:$,influenceRadius:_,minDistance:H,maxAcceleration:.3*U},av=U),au);for(let a=0;a<c.length;a++){if(n.has(a))continue;let b=c[a];if(b.exploding)continue;let h=d-b.createdAt;if(h>Y&&h>Y+A)continue;let i=P?{x:0,y:0}:ad({x:b.x,y:b.y},o,p),m=b.vx+i.x,q=b.vy+i.y,r=ae({x:m,y:q},.5);m=r.x,q=r.y;let s=b.x+m,t=b.y+q,u=ab({x:s,y:t},{x:m,y:q},l,{left:0,right:e,top:0,bottom:f});for(let a of(s=u.newPosition.x,t=u.newPosition.y,m=u.newVelocity.x,q=u.newVelocity.y,g)){let c=ac({x:s,y:t},{x:m,y:q},l,{x:a.x,y:a.y,width:a.width,height:a.height},{x:b.x,y:b.y});if(c.bounced){s=c.newPosition.x,t=c.newPosition.y,m=c.newVelocity.x,q=c.newVelocity.y;break}}let v=!1;for(let a=0;a<k.length;a++){let b=k[a];if(b.lives>0){if(void 0!==b.invincibleUntil&&d<b.invincibleUntil)continue;let c=s-l/2,e=t-l/2,f=s+l/2,g=t+l/2,h=(Q-R)/2,i=b.x+h,j=b.y+h,m=i+R,n=j+R;if(c<m&&f>i&&e<n&&g>j){let c=b.lives-1;k[a]={...b,lives:c},v=!0;break}}}if(v)continue;let w=Math.atan2(q,m)*ag;j.push({...b,x:s,y:t,angle:w,vx:m,vy:q})}return{updatedBullets:j,updatedTanks:k}}({bullets:t,tickTime:h,mapWidth:a.width,mapHeight:a.height,barriers:b,suns:c,tanks:s}),x=m.current.get(q.id)||!1;if(!x&&q.episodeStartTime&&h-q.episodeStartTime>=g){m.current.set(q.id,!0);let a=w.updatedTanks[0],b=w.updatedTanks[1],c=null;a&&b&&(a.lives>b.lives?c="blue":b.lives>a.lives&&(c="red")),w.updatedBullets=[],w.updatedTanks[0]={...a,exploding:!1,explosionStartTime:void 0,respawning:!1,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0,invincibleUntil:void 0},w.updatedTanks[1]={...b,exploding:!1,explosionStartTime:void 0,respawning:!1,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0,invincibleUntil:void 0},i(q.id,w.updatedTanks),j(q.id,w.updatedBullets),l(q.id,c);return}let y=w.updatedTanks[0],z=w.updatedTanks[1];if(!x&&y&&z&&(y.lives<=0||z.lives<=0)){m.current.set(q.id,!0);let a=y.lives<=0?"red":"blue";w.updatedBullets=[],w.updatedTanks[0]={...y,exploding:!1,explosionStartTime:void 0,respawning:!1,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0,invincibleUntil:void 0},w.updatedTanks[1]={...z,exploding:!1,explosionStartTime:void 0,respawning:!1,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0,invincibleUntil:void 0},i(q.id,w.updatedTanks),j(q.id,w.updatedBullets),l(q.id,a);return}for(let d=0;d<w.updatedTanks.length;d++){let e=w.updatedTanks[d],f=s[d];if(e.lives<f.lives&&e.lives>0){let f=e.color,g=[];for(let a of w.updatedBullets)a.owner!==f&&g.push(a);w.updatedBullets=g;let i=aw(a,b,w.updatedTanks,c,0===d?w.updatedTanks[1]:w.updatedTanks[0]?{x:w.updatedTanks[+(0===d)].x,y:w.updatedTanks[+(0===d)].y}:void 0);w.updatedTanks[d]={...e,x:i.x,y:i.y,angle:i.angle,exploding:!1,explosionStartTime:void 0,respawning:!1,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0,invincibleUntil:h+2e3}}(e.exploding||e.respawning)&&(w.updatedTanks[d]={...e,exploding:!1,explosionStartTime:void 0,respawning:!1,respawnStartTime:void 0,respawnTargetX:void 0,respawnTargetY:void 0,respawnTargetAngle:void 0}),void 0!==e.invincibleUntil&&h>=e.invincibleUntil&&(w.updatedTanks[d]={...e,invincibleUntil:void 0})}x||(i(q.id,w.updatedTanks),j(q.id,w.updatedBullets),k(q.id,u))}},[a,b,c,d,f,g,i,j,k,l])}}function aS({width:a,height:b,tanks:c,bullets:f,barriers:g,suns:h,isPaused:i,tankImages:j,gameOverWinner:k,scale:l=1}){let m=(0,e.useRef)(null);(0,e.useEffect)(()=>{let a=m.current;if(a){a.focus();let b=()=>{a.focus()};return a.addEventListener("click",b),()=>{a.removeEventListener("click",b)}}},[]),(0,e.useEffect)(()=>{let d=m.current;if(!d)return;let e=d.getContext("2d");if(!e)return;for(let c of(d.width=2*a,d.height=2*b,e.setTransform(1,0,0,1,0,0),e.scale(2,2),e.clearRect(0,0,a,b),e.fillStyle="#2D3748",e.fillRect(0,0,a,b),e.fillStyle="#4A5568",g))e.fillRect(c.x,c.y,c.width,c.height);if(!P)for(let a of(e.strokeStyle="rgba(98, 156, 119, 0.3)",e.fillStyle="rgba(98, 156, 119, 0.3)",e.lineWidth=.5,h))for(let b=a.x-_;b<=a.x+_;b+=30)for(let c=a.y-_;c<=a.y+_;c+=30){let d=a.x-b,f=a.y-c,g=Math.sqrt(d*d+f*f);if(g>a.size+5&&g<_){let a=Math.atan2(f,d),h=d/g,i=f/g;e.beginPath(),e.moveTo(b,c),e.lineTo(b+8*h,c+8*i),e.stroke(),e.save(),e.translate(b+8*h,c+8*i),e.rotate(a),e.beginPath(),e.moveTo(0,0),e.lineTo(-3,-1.5),e.lineTo(-3,1.5),e.closePath(),e.fill(),e.restore()}}if(!P)for(let a of h){let b=e.createRadialGradient(a.x,a.y,0,a.x,a.y,a.size);b.addColorStop(0,"rgba(98, 156, 119, 0.9)"),b.addColorStop(.7,"rgba(98, 156, 119, 0.75)"),b.addColorStop(1,"rgba(98, 156, 119, 0)"),e.fillStyle=b,e.beginPath(),e.arc(a.x,a.y,a.size,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(98, 156, 119, 0.5)",e.lineWidth=1,e.stroke()}for(let a of c.length>=2?[c[0],c[1]]:c.slice(0,2)){if(a.lives<=0||void 0===a.x||void 0===a.y)continue;if(e.save(),void 0!==a.invincibleUntil&&Date.now()<a.invincibleUntil){let b=a.x+Q/2,c=a.y+Q/2,d=Q/2+3;e.beginPath(),e.arc(b,c,d,0,2*Math.PI),e.strokeStyle="#FFD700",e.lineWidth=1,e.stroke()}e.translate(a.x+Q/2,a.y+Q/2),e.rotate(a.angle*Math.PI/180),e.translate(-Q/2,-Q/2);let b="blue"===a.color?j.blue:j.red;b?e.drawImage(b,0,0,Q,Q):(e.fillStyle="blue"===a.color?"#3B82F6":"#EF4444",e.fillRect(0,0,Q,Q),e.strokeStyle="blue"===a.color?"#1E40AF":"#DC2626",e.lineWidth=1,e.strokeRect(0,0,Q,Q)),e.restore(),e.fillStyle="blue"===a.color?"#3B82F6":"#EF4444";for(let b=0;b<a.lives;b++)e.beginPath(),e.arc(a.x+K+b*J,a.y+L,I,0,2*Math.PI),e.fill()}for(let a of f){if(a.exploding)continue;let b=Date.now()-a.createdAt,c=A,d=1;if(b>Y&&(d=Math.max(0,1-(b-Y)/c)),d>0){let b="blue"===a.owner?59:239,c="blue"===a.owner?130:68,f="blue"===a.owner?246:68;e.save(),e.globalAlpha=d;let g=a.angle*Math.PI/180;e.translate(a.x,a.y),e.rotate(g);e.fillStyle=`rgb(${b}, ${c}, ${f})`,e.beginPath(),e.moveTo(-2,-1.5),e.lineTo(2,-1.5),e.quadraticCurveTo(3,-1.5,3,-.5),e.lineTo(3,.5),e.quadraticCurveTo(3,1.5,2,1.5),e.lineTo(-2,1.5),e.quadraticCurveTo(-3,1.5,-3,.5),e.lineTo(-3,-.5),e.quadraticCurveTo(-3,-1.5,-2,-1.5),e.closePath(),e.fill(),e.restore()}}e.textAlign="right",e.fillStyle="rgba(255, 255, 255, 0.8)",e.font=`${M-1}px Inter`;let l=O,n=a-N;e.fillText("Player 1 (Blue): Arrows + Space",n,l),e.fillText("Player 2 (Red): WASD + Q",n,l+12),e.textAlign="left",k&&(e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,a,b),e.fillStyle="#FFFFFF",e.font="bold 32px Inter",e.textAlign="center",e.fillText("blue"===k?"BLUE WINS!":"RED WINS!",a/2,b/2-20),e.font="20px Inter",e.fillText("Press any key to play again",a/2,b/2+20),e.textAlign="left"),i&&!k&&(e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,a,b),e.fillStyle="#FFFFFF",e.font="bold 48px Inter",e.textAlign="center",e.fillText("PAUSED",a/2,b/2),e.textAlign="left")},[a,b,c,f,g,h,i,j,k]);let n=2*a*l,o=2*b*l;return(0,d.jsx)("canvas",{ref:m,className:"border-2 border-[#4A5568] rounded outline-none",style:{width:`${n}px`,height:`${o}px`,display:"block"},tabIndex:0,onFocus:a=>a.target.focus()})}a.i(72322),a.i(24532),a.i(40693),a.i(26838);var aT=a.i(8926);a.i(712),a.i(79188),a.i(17386),a.i(27899),a.i(91020),a.i(28940),a.i(32984);var aU=a.i(4809);a.i(10916),a.i(6364),a.i(46821),a.i(56536);var aU=aU,aV=a.i(2439),aW=a.i(2371),aX=a.i(40463);a.i(73830),a.i(91445);let aY={observationSize:152,actionSize:aA,learningRate:.001,hiddenLayers:[128,128,64],gamma:.99,epsilonStart:1,epsilonEnd:.01,epsilonDecay:.995,batchSize:32,replayBufferSize:1e4,targetUpdateFrequency:100};class aZ{qNetwork=null;targetNetwork=null;config;epsilon;stepCount=0;trainingInProgress=null;isDisposed=!1;constructor(a={}){this.config={...aY,...a},this.epsilon=this.config.epsilonStart}async initialize(){this.qNetwork=this.createNetwork(),this.targetNetwork=this.createNetwork(),this.updateTargetNetwork()}createNetwork(){let a=aU.sequential();a.add(aT.dense({inputShape:[this.config.observationSize],units:this.config.hiddenLayers[0],activation:"relu",kernelInitializer:"heNormal"}));for(let b=1;b<this.config.hiddenLayers.length;b++)a.add(aT.dense({units:this.config.hiddenLayers[b],activation:"relu",kernelInitializer:"heNormal"}));return a.add(aT.dense({units:this.config.actionSize,activation:"linear",kernelInitializer:"zeros"})),a.compile({optimizer:aV.train.adam(this.config.learningRate),loss:"meanSquaredError"}),a}areNetworksValid(){return!this.isDisposed&&null!==this.qNetwork&&null!==this.targetNetwork}async selectAction(a,b=!0){if(!this.qNetwork)throw Error("Network not initialized. Call initialize() first.");if(b&&Math.random()<this.epsilon)return Math.floor(Math.random()*this.config.actionSize);let c=aW.tensor2d([a.vector]),d=g(this.qNetwork.predict(c),a=>a instanceof aX.Tensor,"Expected Tensor from predict"),e=await d.data();c.dispose(),d.dispose();let f=0,h=e[0];for(let a=1;a<e.length;a++)e[a]>h&&(h=e[a],f=a);return f}async predict(a,b){var c=await this.selectAction(a,!1);let d={angleDelta:0,moveDirection:0,shouldShoot:!1};switch(c){case 0:break;case 1:d.angleDelta=-V;break;case 2:d.angleDelta=V;break;case 3:d.moveDirection=1;break;case 4:d.moveDirection=-1;break;case 5:d.shouldShoot=!0;break;case 6:d.angleDelta=-V,d.moveDirection=1;break;case 7:d.angleDelta=V,d.moveDirection=1;break;case 8:d.angleDelta=-V,d.shouldShoot=!0;break;case 9:d.angleDelta=V,d.shouldShoot=!0;break;case 10:d.moveDirection=1,d.shouldShoot=!0;break;case 11:d.moveDirection=-1,d.shouldShoot=!0;break;case 12:d.angleDelta=-V,d.moveDirection=-1;break;case 13:d.angleDelta=V,d.moveDirection=-1}return d}async train(a){let b,c;if(!this.areNetworksValid()||0===a.length)return 0;if(this.trainingInProgress){try{await this.trainingInProgress}catch(a){}return 0}this.trainingInProgress=new Promise((a,d)=>{b=a,c=d}),this.executeTraining(a,this.trainingInProgress).then(a=>{this.trainingInProgress=null,b&&b(a)}).catch(a=>{this.trainingInProgress=null,c&&c(a)});try{return await this.trainingInProgress}catch(a){return 0}}async executeTraining(a,b){let c=Math.min(a.length,this.config.batchSize),d=[],e=[],f=[],h=[],i=[];for(let b=0;b<c;b++){let c=a[b];d.push(c.state),e.push(c.action),f.push(c.reward),h.push(c.nextState),i.push(c.done)}let j=aW.tensor2d(d),m=aW.tensor2d(h),n=[j,m];try{if(!this.areNetworksValid()||this.trainingInProgress!==b)return 0;if(!this.qNetwork||!this.targetNetwork)throw Error("Networks not initialized");let a=this.qNetwork.predict(j),d=this.targetNetwork.predict(m),h=g(a,a=>a instanceof aX.Tensor,"Expected Tensor from predict"),l=g(d,a=>a instanceof aX.Tensor,"Expected Tensor from predict");n.push(h,l);let o=await h.array(),p=await l.array(),q=g(o,k,"Expected 2D number array from tensor.array()"),r=g(p,k,"Expected 2D number array from tensor.array()");if(!this.areNetworksValid()||this.trainingInProgress!==b)return 0;let s=[];for(let a=0;a<c;a++){let b=[...q[a]],c=Math.max(...r[a]),d=f[a]+(i[a]?0:this.config.gamma*c);b[e[a]]=d,s.push(b)}let t=aW.tensor2d(s);if(n.push(t),!this.areNetworksValid()||this.trainingInProgress!==b)return 0;if(!this.qNetwork)throw Error("Network not initialized");let u=await this.qNetwork.fit(j,t,{epochs:1,verbose:0,batchSize:c}),v=0;if(Array.isArray(u.history.loss)){let a=u.history.loss[0];"number"==typeof a&&(v=a)}else if("number"==typeof u.history.loss)v=u.history.loss;else if(u.history.loss&&"object"==typeof u.history.loss)try{let a=JSON.stringify(u.history.loss);JSON.parse(a)}catch{}return this.epsilon=Math.max(this.config.epsilonEnd,this.epsilon*this.config.epsilonDecay),this.stepCount++,this.stepCount%this.config.targetUpdateFrequency==0&&this.updateTargetNetwork(),v}catch(a){return!(l(a)?a.message:String(a)).includes("disposed"),0}finally{n.forEach(a=>{try{a.dispose()}catch(a){}})}}updateTargetNetwork(){if(!this.qNetwork||!this.targetNetwork)return;let a=this.qNetwork.getWeights();this.targetNetwork.setWeights(a)}getEpsilon(){return this.epsilon}async save(a){throw Error("Cannot save model: IndexedDB is only available in the browser (not during SSR)")}async load(a){throw Error("Cannot load model: IndexedDB is only available in the browser (not during SSR)")}async loadWeightsFromJSON(a){throw Error("Cannot load weights: Only available in browser")}dispose(){this.isDisposed=!0;let a=()=>{this.qNetwork&&this.qNetwork.dispose(),this.targetNetwork&&this.targetNetwork.dispose()};this.trainingInProgress?this.trainingInProgress.then(a).catch(a):a()}}class a${buffer=[];maxSize;currentIndex=0;constructor(a=1e4){this.maxSize=a}add(a){this.buffer.length<this.maxSize?this.buffer.push(a):(this.buffer[this.currentIndex]=a,this.currentIndex=(this.currentIndex+1)%this.maxSize)}addBatch(a){for(let b of a)this.add(b)}sample(a){if(this.buffer.length<a)return[...this.buffer];let b=[],c=[];for(;b.length<a;){let a=Math.floor(Math.random()*this.buffer.length);b.includes(a)||(b.push(a),c.push(this.buffer[a]))}return c}size(){return this.buffer.length}canSample(a){return this.buffer.length>=a}clear(){this.buffer=[],this.currentIndex=0}getAll(){return[...this.buffer]}}var a_=a.i(85594);class a0{agent;replayBuffer;env;config;stats;isTraining=!1;currentEpisode=0;completedEpisodes=0;stepCount=0;hasTrainedAtLeastOnce=!1;gameStates=new Map;activeGameEpisodes=new Set;gameEpisodeRewards=new Map;gameEpisodeLengths=new Map;constructor(a={}){this.config={dqn:{},episodes:1e3,trainEvery:4,saveEvery:100,selfPlay:!0,headless:!1,maxEpisodeTimeMs:6e4,...a},this.agent=new aZ({...aY,...this.config.dqn}),this.replayBuffer=new a$(this.config.dqn.replayBufferSize||aY.replayBufferSize),this.env=new aP(this.config.maxEpisodeTimeMs),this.stats={episode:0,episodeReward:0,episodeLength:0,totalReward:0,averageReward:0,epsilon:1,loss:0}}async initialize(){await this.agent.initialize();let a=new aI({name:"TankTroubleRL",type:"discrete",observationSize:aY.observationSize,actionSize:aY.actionSize}),b={isLoaded:()=>a.isLoaded(),load:b=>a.load(b),getInfo:()=>a.getInfo(),agent:this.agent,predict:(a,b)=>({angleDelta:0,moveDirection:0,shouldShoot:!1})};aJ.setModel(b)}async step(a,b,c,d){if(!this.isTraining)return;this.env.getObservation(a);let e=d||"default",f=this.gameStates.get(e);if(!f||!f.observation){f=this.env.reset(a),this.gameStates.set(e,f),this.activeGameEpisodes.add(e),this.gameEpisodeRewards.set(e,0),this.gameEpisodeLengths.set(e,0),this.updateSharedStats();return}let g=0;g=null!=c?c:await this.agent.selectAction(f.observation,!0);let h=this.env.step(g,a,b);if(!f||!f.observation||!h||!h.observation)return void this.gameStates.set(e,h||this.env.reset(a));let i={state:f.observation.vector,action:g,reward:h.reward,nextState:h.observation.vector,done:h.done};this.replayBuffer.add(i);let j=this.gameEpisodeRewards.get(e)||0,k=this.gameEpisodeLengths.get(e)||0;if(this.gameEpisodeRewards.set(e,j+h.reward),this.gameEpisodeLengths.set(e,k+1),this.updateSharedStats(),this.stats.episodeLength,this.stepCount++,this.stepCount%this.config.trainEvery==0&&this.replayBuffer.canSample(32)){let a=this.replayBuffer.sample(32),b=await this.agent.train(a);this.stats.loss=b,this.hasTrainedAtLeastOnce=!0,this.config.onTrainingUpdate&&this.config.onTrainingUpdate({loss:b,epsilon:this.agent.getEpsilon()})}h.done?(await this.onEpisodeComplete(h,e),this.gameStates.delete(e)):this.gameStates.set(e,h)}updateSharedStats(){let a=0,b=0;for(let[b,c]of this.gameEpisodeRewards.entries())this.activeGameEpisodes.has(b)&&(a+=c);for(let[a,c]of this.gameEpisodeLengths.entries())this.activeGameEpisodes.has(a)&&(b+=c);this.stats.episodeReward=a,this.stats.episodeLength=b}incrementEpisode(){if(this.currentEpisode++,this.stats.episode=this.currentEpisode,this.stats.epsilon=this.agent.getEpsilon(),this.completedEpisodes>0&&(this.stats.averageReward=this.stats.totalReward/this.completedEpisodes),this.currentEpisode%this.config.saveEvery==0){let a=Date.now(),b=new Date(a).toISOString(),c=this.stats.averageReward;this.saveModel(`indexeddb://tank-ai-${a}`,c,b).catch(a=>{console.error("Error saving model:",a)})}this.config.onEpisodeComplete&&this.config.onEpisodeComplete({...this.stats})}async onEpisodeComplete(a,b){let c=b.includes("-blue"),d=c?b.replace("-blue",""):b,e=this.gameEpisodeRewards.get(d)||0,f=this.gameEpisodeRewards.get(`${d}-blue`)||0;this.gameEpisodeLengths.get(d),this.gameEpisodeLengths.get(`${d}-blue`),!c&&(this.stats.totalReward+=e+f,this.completedEpisodes++,this.completedEpisodes>0&&(this.stats.averageReward=this.stats.totalReward/this.completedEpisodes)),this.activeGameEpisodes.delete(d),this.activeGameEpisodes.delete(`${d}-blue`),this.updateSharedStats()}start(){this.isTraining||(this.isTraining=!0,this.currentEpisode=0,this.completedEpisodes=0,this.stepCount=0,this.stats.episodeReward=0,this.stats.episodeLength=0,this.stats.totalReward=0,this.stats.averageReward=0,this.activeGameEpisodes.clear(),this.gameEpisodeRewards.clear(),this.gameEpisodeLengths.clear())}stop(){this.isTraining=!1}getIsTraining(){return this.isTraining}getStats(){return{...this.stats}}canSaveModel(){let a=this.replayBuffer.canSample(32),b=this.currentEpisode>0;return a&&b&&this.hasTrainedAtLeastOnce}getReplayBufferSize(){return this.replayBuffer.size()}async saveModel(a,b,c){let d=a.startsWith("indexeddb://")?a:`indexeddb://${a}`;if(!this.agent)throw Error("Agent not initialized. Cannot save model.");try{await this.agent.save(d)}catch(a){throw console.error("RLTrainingManager: Model weights save/verification failed:",a),Error(`Failed to save model weights: ${a instanceof Error?a.message:String(a)}`)}try{await (0,a_.saveModelWithMetadata)(d,b,c)}catch(a){console.warn("RLTrainingManager: Failed to save model metadata (weights are saved):",a)}}async loadModel(a){await this.agent.load(`indexeddb://${a}`)}resetEpisode(a,b){let c=this.env.reset(a);this.gameStates.set(b||"default",c)}getMaxEpisodeTimeMs(){return this.config.maxEpisodeTimeMs}dispose(){this.stop(),this.agent.dispose(),this.replayBuffer.clear()}}function a1({stats:a,onUpdate:b}){let c=(0,e.useRef)(null);return(0,e.useEffect)(()=>{let d=c.current;d&&d.episodeReward===a.episodeReward&&d.episodeLength===a.episodeLength||(c.current=a,b(a))},[a.episodeReward,a.episodeLength,b]),null}let a2={width:(b=n(f.default,function(a){return!!h(a)&&m(a,"width",i)&&m(a,"height",i)&&m(a,"barriers",a=>j(a))&&m(a,"spawnPoints",a=>j(a))&&(!("suns"in a)||m(a,"suns",a=>j(a)))},"Invalid map data structure: missing or invalid required properties")).width,height:b.height,barriers:b.barriers,spawnPoints:b.spawnPoints,suns:b.suns||[]};function a3(){let a=a2.barriers||[],b=[],[c,f]=(0,e.useState)(!1),[g,h]=(0,e.useState)(0),i=(0,e.useRef)(null),[j,k]=(0,e.useState)({totalGames:0,aiVsAiGames:0,personVsAiGames:0}),[m,n]=(0,e.useState)(4),[o,r]=(0,e.useState)([]),[s,t]=(0,e.useState)(""),[u,v]=(0,e.useState)(!1),w=(0,e.useRef)(""),[x,y]=(0,e.useState)(null),z=(0,e.useCallback)(a=>{y(b=>b&&b.reward===a.episodeReward&&b.length===a.episodeLength?b:{reward:a.episodeReward,length:a.episodeLength})},[]),[A,B]=(0,e.useState)(null),C=(0,e.useRef)(5),[D,E]=(0,e.useState)(Date.now());(0,e.useEffect)(()=>{let a=setInterval(()=>{E(Date.now())},1e3);return()=>clearInterval(a)},[]);let[F,G]=(0,e.useState)(()=>Array.from({length:4},(c,d)=>({id:d,tanks:ax(a2,a,b),bullets:[],lastShotTimes:{blue:0,red:0},gameOverWinner:null,episodeReward:0,episodeLength:0,episodeStartTime:Date.now(),gameType:"ai-vs-ai",episodeNumber:d+1}))),H=function(a={}){let[b,c]=(0,e.useState)(!1),[d,f]=(0,e.useState)(null),[g,h]=(0,e.useState)(!1),i=(0,e.useRef)(null),j=(0,e.useRef)(a);(0,e.useEffect)(()=>{j.current=a},[a]);let k=(0,e.useRef)(a.onEpisodeComplete),l=(0,e.useRef)(a.onTrainingUpdate);(0,e.useEffect)(()=>{k.current=a.onEpisodeComplete,l.current=a.onTrainingUpdate},[a.onEpisodeComplete,a.onTrainingUpdate]),(0,e.useEffect)(()=>{let a=new a0({...j.current,onEpisodeComplete:a=>{f(b=>{let c=(b?.loss??0)>0?b?.loss??0:a.loss;return{...a,loss:c}}),k.current&&k.current(a)},onTrainingUpdate:a=>{f(b=>{let c=a=>"string"==typeof a&&["episode","episodeReward","episodeLength","totalReward","averageReward","epsilon","loss"].includes(a),d={};for(let[b,e]of Object.entries(a))void 0!==e&&c(b)&&(d[b]=e);return b?Object.keys(d).some(a=>!!c(a)&&b[a]!==d[a])?{...b,...d}:b:{episode:0,episodeReward:0,episodeLength:0,totalReward:0,averageReward:0,epsilon:1,loss:0,...d}}),l.current&&l.current(a)}});return a.initialize().then(()=>{h(!0),i.current=a,f(a.getStats())}),()=>{i.current&&i.current.dispose()}},[]);let m=async(a,c,d)=>{i.current&&b&&await i.current.step(a,c,d)};return{isTraining:b,isInitialized:g,stats:d,startTraining:()=>{i.current&&g&&(i.current.start(),c(!0))},stopTraining:()=>{i.current&&(i.current.stop(),c(!1))},step:m,saveModel:async(a,b,c)=>{i.current&&await i.current.saveModel(a,b,c)},loadModel:async a=>{i.current&&await i.current.loadModel(a)},resetEpisode:a=>{i.current&&i.current.resetEpisode(a)},incrementEpisode:()=>{i.current&&i.current.incrementEpisode()},canSaveModel:()=>!!i.current&&i.current.canSaveModel(),getReplayBufferSize:()=>i.current?i.current.getReplayBufferSize():0,get manager(){return i.current}}}({episodes:1e3,trainEvery:4,saveEvery:100,selfPlay:!0}),I=F.length;(0,e.useEffect)(()=>{if(H.stats&&void 0!==H.stats.episode){let a=H.stats.episode;k(b=>({...b,totalGames:a}))}},[H.stats?.episode]),(0,e.useEffect)(()=>{H.stats&&void 0!==H.stats.episode&&n(H.stats.episode+I)},[H.stats?.episode,I]);let J=(0,e.useCallback)(async()=>{if(!H.manager||!H.canSaveModel())return!1;try{H.stats?.episode;let a=Date.now();return new Date(a).toISOString(),H.stats?.averageReward,!0}catch(a){return console.error("Error auto-saving model:",a),!1}},[H,I]);(0,e.useEffect)(()=>{if(c&&H.isTraining)return i.current&&clearInterval(i.current),i.current=setInterval(()=>{J()},3e5),()=>{i.current&&clearInterval(i.current)};i.current&&(clearInterval(i.current),i.current=null)},[c,H.isTraining,J]),(0,e.useEffect)(()=>{let d=c?8:4;G(c=>{if(c.length===d)return c;if(c.length<d){let e=Array.from({length:d-c.length},(d,e)=>({id:c.length+e,tanks:ax(a2,a,b),bullets:[],lastShotTimes:{blue:0,red:0},gameOverWinner:null,episodeReward:0,episodeLength:0,episodeStartTime:Date.now(),gameType:"ai-vs-ai",episodeNumber:C.current++}));return[...c,...e]}{let a=c.slice(0,d);if(-1===(null!==A?a.findIndex(a=>a.id===A):-1)&&null!==A){let a=c.find(a=>a.id===A);if(a)return[...c.filter(a=>a.id!==A).slice(0,d-1),a]}return a}})},[c,a2,a,b,A]);let K=q(),L=p({gameOver:null!==A&&F[A]?.gameOverWinner!==null}),M=(0,e.useRef)(new Set),N=(0,e.useCallback)(a=>a===A?L.keysRef:M,[A,L.keysRef]),O=a=>{A===a&&B(null),G(b=>b.map(b=>b.id===a?{...b,gameType:"ai-vs-ai"}:b))},P=H.manager?.getMaxEpisodeTimeMs()||6e4,Q=(0,e.useMemo)(()=>F.map(a=>({id:a.id,tanks:a.tanks,bullets:a.bullets,lastShotTimes:a.lastShotTimes,gameMode:"person-vs-ai"===a.gameType?"person-vs-ai":"ai",gameId:`game-${a.id}`,isPaused:!H.isTraining||a.id===A&&L.isPaused,speedMultiplier:(a.gameType,1),episodeStartTime:a.episodeStartTime,keysRef:N(a.id)})),[F,H.isTraining,A,L.isPaused,N]),R=aR({mapData:a2,barriers:a,suns:b,aiConfig:aL,trainingManager:H.manager,maxEpisodeTimeMs:P,gameInstances:Q,onTanksUpdate:(a,b)=>{G(c=>c.map(c=>c.id===a?{...c,tanks:b}:c))},onBulletsUpdate:(a,b)=>{G(c=>c.map(c=>c.id===a?{...c,bullets:b}:c))},onLastShotTimesUpdate:(a,b)=>{G(c=>c.map(c=>c.id===a?{...c,lastShotTimes:b}:c))},onGameOver:(c,d)=>{let e=C.current++;H.incrementEpisode();let f=F.find(a=>a.id===c),g=f?.gameType==="person-vs-ai";G(d=>d.map(d=>d.id===c?(k(a=>({...a,aiVsAiGames:"ai-vs-ai"===d.gameType?a.aiVsAiGames+1:a.aiVsAiGames,personVsAiGames:"person-vs-ai"===d.gameType?a.personVsAiGames+1:a.personVsAiGames})),{...d,tanks:ax(a2,a,b),bullets:[],lastShotTimes:{blue:0,red:0},gameOverWinner:null,episodeReward:0,episodeLength:0,episodeStartTime:Date.now(),episodeNumber:e}):d)),c!==A||g||B(null)}});(0,e.useEffect)(()=>{if(!H.isTraining)return;let a=[],b=performance.now(),c=async d=>{for(let a of F){"ai-vs-ai"===a.gameType&&!1;await R.gameTick({gameId:a.id});if(a.episodeStartTime){let b=Math.floor(72*((Date.now()-a.episodeStartTime)/1e3));a.episodeLength!==b&&G(c=>c.map(c=>c.id===a.id?{...c,episodeLength:b}:c))}}b=d;let e=requestAnimationFrame(c);a.push(e)},d=requestAnimationFrame(c);return a.push(d),()=>{a.forEach(a=>cancelAnimationFrame(a))}},[H.isTraining,R,F]);let S=(0,e.useCallback)(async()=>{v(!0);try{let a=await (0,a_.listSavedModels)();r(a),w.current&&a.some(a=>a.path===w.current)}catch(a){console.error("Failed to load models:",a),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&void 0===window.indexedDB&&console.warn("Safari detected with IndexedDB unavailable. This may be due to Private Browsing mode.")}finally{v(!1)}},[]);(0,e.useEffect)(()=>{S()},[S]),(0,e.useEffect)(()=>{if(H.stats&&H.stats.episode>0&&H.stats.episode%100==0){let a=w.current;S().then(()=>{a&&(t(a),w.current=a)})}},[H.stats?.episode,S]);let T=async a=>{if(a)try{t(a),w.current=a;let b=new aZ;await b.load(a);let c=new aI({name:"TankTroubleRL",type:"discrete",observationSize:142,actionSize:14});if(aJ.setModel({isLoaded:()=>c.isLoaded(),load:a=>c.load(a),getInfo:()=>c.getInfo(),agent:b,predict:(a,b)=>({angleDelta:0,moveDirection:0,shouldShoot:!1})}),H.manager){let b=a.replace("indexeddb://","");await H.manager.loadModel(b)}alert("Model loaded successfully! Training will continue from this model.")}catch(d){console.error("Failed to load model:",d);let a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),b=d instanceof Error?d.message:String(d),c="Failed to load model.\n\n";a&&(c+='Safari detected. Common issues:\n Private Browsing mode disables IndexedDB - try regular browsing mode\n Safari may require user interaction before accessing IndexedDB\n Check Safari settings: Preferences > Privacy > uncheck "Prevent cross-site tracking"\n\n'),alert(c+=`Error: ${b}

Check the browser console for more details.`)}},U=Math.ceil(Math.sqrt(4)),V=aJ.getModel().getInfo(),W=aJ.isRLActive();return(0,d.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,d.jsx)("div",{className:"flex gap-4",children:(0,d.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,d.jsxs)("div",{className:"p-4 bg-white border border-gray-300 rounded shadow",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("label",{className:"text-sm font-semibold whitespace-nowrap",children:"Select Model (Optional):"}),(0,d.jsxs)("select",{value:s,onChange:a=>T(a.target.value),className:"px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",style:{maxWidth:"200px"},disabled:u,children:[(0,d.jsx)("option",{value:"",children:u?"Loading models...":"-- Select a model --"}),0===o.length&&!u&&(0,d.jsx)("option",{value:"",disabled:!0,children:"No saved models found"}),o.map(a=>(0,d.jsxs)("option",{value:a.path,children:[a.createdAtString,void 0!==a.evalScore?` (Eval: ${a.evalScore.toFixed(2)})`:""]},a.path))]}),(0,d.jsx)("button",{onClick:S,style:{backgroundColor:"#e5e7eb"},className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:bg-gray-200 disabled:opacity-50 text-sm font-medium whitespace-nowrap flex-shrink-0",disabled:u,children:u?"Loading...":"Refresh"}),(0,d.jsx)("button",{onClick:async()=>{try{v(!0);let a=await fetch("/api/backend/models/latest");if(!a.ok)throw Error(`Failed to fetch model: ${a.statusText}`);await a.json(),new aZ,alert("Model fetched from backend! (Conversion to TensorFlow.js format pending)")}catch(a){console.error("Error fetching model from backend:",a),alert(`Failed to fetch model from backend: ${a instanceof Error?a.message:String(a)}`)}finally{v(!1)}},style:{backgroundColor:"#dbeafe"},className:"px-3 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:bg-gray-200 disabled:opacity-50 text-sm font-medium whitespace-nowrap flex-shrink-0",disabled:u,children:u?"Loading...":"Fetch from Backend"})]}),(0,d.jsx)("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Models are saved in your browser's local storage (Dexie DB). Maximum 8 models kept."})]}),(0,d.jsxs)("div",{className:"p-4 bg-white border border-gray-300 rounded shadow",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,d.jsx)("button",{onClick:async()=>{try{if(!H.manager)return void alert("Training manager not initialized. Please wait for initialization.");if(!H.canSaveModel()){let a=H.getReplayBufferSize(),b=(H.stats?.episode??0)>0,c="Cannot save model yet. Requirements:\n";a<32&&(c+=`- Need at least 32 steps in replay buffer (current: ${a})
`),b||(c+="- Need at least one completed episode\n"),a>=32&&b&&(c+="- Need to wait for training to occur (training happens every 4 steps when buffer has 32+ steps)\n"),alert(c);return}H.stats?.episode;let a=Date.now();new Date(a).toISOString(),H.stats?.averageReward,alert("Frontend training is disabled. Models are saved automatically by the backend training service every 5 minutes.")}catch(b){console.error("Error saving model:",b);let a=l(b)?b.message:String(b);alert(`Failed to save model: ${a}

Check the browser console for details.`)}},disabled:!H.manager||!H.canSaveModel(),style:{backgroundColor:H.manager&&H.canSaveModel()?"#bfdbfe":"#d1d5db",opacity:H.manager&&H.canSaveModel()?1:.6,cursor:H.manager&&H.canSaveModel()?"pointer":"not-allowed"},className:`px-4 py-2 rounded font-medium ${!H.manager||!H.canSaveModel()?"bg-gray-300 text-gray-500":"bg-blue-200 text-blue-700 hover:bg-blue-300"}`,title:H.manager&&H.canSaveModel()?"Save current model (creates new model, does not overwrite)":"Requirements: 32+ steps in replay buffer, at least 1 episode completed, and training must have occurred at least once",children:"Save Model"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"headless-mode",checked:c,onChange:a=>f(a.target.checked),className:"w-4 h-4"}),(0,d.jsx)("label",{htmlFor:"headless-mode",className:"text-sm font-medium cursor-pointer",children:"Headless Training (8 games, auto-save every 5 min)"}),c&&g>0&&(0,d.jsxs)("span",{className:"text-xs text-gray-600",children:["(Auto-saved: ",g,")"]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,d.jsx)("span",{className:`inline-block w-3 h-3 rounded-full ${H.isTraining?"bg-green-500":"bg-gray-400"}`}),(0,d.jsx)("span",{children:H.isTraining?"Training Active":"Training Stopped"})]})]}),(0,d.jsx)("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Saving a model requires: 32+ steps in replay buffer, at least 1 episode completed, and training must have occurred at least once"})]}),(0,d.jsx)("div",{className:"p-4 bg-white border border-gray-300 rounded shadow",children:(0,d.jsxs)("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${Math.min(I,8)}, 1fr)`},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Total Games"}),(0,d.jsx)("div",{className:"text-2xl font-bold",children:H.stats?.episode||0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"AI vs AI"}),(0,d.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:j.aiVsAiGames})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Person vs AI"}),(0,d.jsx)("div",{className:"text-2xl font-bold text-green-600",children:j.personVsAiGames})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Active Games"}),(0,d.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:I})]})]})}),(0,d.jsxs)("div",{className:"p-4 bg-white border border-gray-300 rounded shadow",children:[(0,d.jsx)("h3",{className:"font-semibold mb-2",children:"Model Summary"}),(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm mb-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Model Type: "}),(0,d.jsx)("span",{className:"font-semibold",children:W?"RL (Trained)":"Rule-Based (Fallback)"})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:"Type of AI model being used"})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Action Space: "}),(0,d.jsx)("span",{className:"font-semibold",children:"discrete"===V.type?"Discrete (14 actions)":"Continuous"})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:"Number of possible actions the AI can take"})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Observation Size: "}),(0,d.jsxs)("span",{className:"font-semibold",children:[V.observationSize," features"]})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:"Number of input features the AI observes"})]})]}),H.stats&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(a1,{stats:H.stats,onUpdate:z}),(0,d.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[(0,d.jsx)("h4",{className:"font-semibold mb-2 text-sm",children:"Training Statistics"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm mb-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Games: "}),(0,d.jsx)("span",{className:"font-semibold",children:H.stats.episode})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:"Total games completed (auto-saves every 100 games). Each game = one complete game session."})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Avg Reward: "}),(0,d.jsx)("span",{className:"font-semibold",children:(H.stats.averageReward??0).toFixed(2)})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:"Average reward per game"})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Epsilon: "}),(0,d.jsx)("span",{className:"font-semibold",children:(H.stats.epsilon??0).toFixed(3)})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:"Exploration rate (higher = more random)"})]})]}),(0,d.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[(0,d.jsx)("h4",{className:"font-semibold mb-2 text-sm",children:"Active Games Stats"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Reward: "}),(0,d.jsx)("span",{className:"font-semibold",children:x?.reward!==void 0?x.reward.toFixed(2):H.stats?.episodeReward.toFixed(2)||"0.00"})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:["Total reward across all ",I," active games (positive = good, negative = poor performance, but still valid training data)"]})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Length: "}),(0,d.jsx)("span",{className:"font-semibold",children:x?.length!==void 0?x.length:H.stats?.episodeLength||0})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-500 italic mt-0.5",children:["Total steps across all ",I," active games (updates every 5 seconds)"]})]})]})]})]})]})]})]})}),(0,d.jsx)("div",{className:"w-full",children:(0,d.jsxs)("div",{className:"p-4 bg-white border border-gray-300 rounded shadow",children:[(0,d.jsx)("h3",{className:"font-semibold mb-3 text-lg",children:"Game Status"}),(0,d.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:F.map(a=>{var b;let c,e=a.tanks[0]?.lives||0,f=a.tanks[1]?.lives||0;a.gameType;let g="person-vs-ai"===a.gameType,h=H.isTraining&&a.episodeStartTime,i=0;return h&&(i=Math.floor((D-a.episodeStartTime)/1e3)),(0,d.jsxs)("div",{className:"border border-gray-200 rounded p-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsxs)("div",{className:"font-semibold text-sm",children:["Game ",a.id+1]}),(0,d.jsx)("div",{className:`text-xs px-2 py-1 rounded ${g?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:g?"Person vs AI":"AI vs AI"})]}),(0,d.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,d.jsx)("span",{className:`font-semibold ${H.isTraining?"text-green-600":"text-gray-400"}`,children:H.isTraining?"Active":"Paused"})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,d.jsx)("span",{className:"font-mono font-semibold text-gray-700",children:h?(c=Math.floor((b=i)/60),`${c}:${(b%60).toString().padStart(2,"0")}`):"N/A"})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-blue-600",children:"Blue Lives:"}),(0,d.jsx)("span",{className:"font-mono font-semibold",children:e})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-red-600",children:"Red Lives:"}),(0,d.jsx)("span",{className:"font-mono font-semibold",children:f})]}),H.stats&&(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Model:"}),(0,d.jsxs)("span",{className:"font-semibold text-blue-600",children:["v",Math.floor((H.stats.episode||0)/4)+1]})]}),a.gameOverWinner&&(0,d.jsxs)("div",{className:"mt-1 pt-1 border-t border-gray-200",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Winner: "}),(0,d.jsx)("span",{className:`font-semibold ${"blue"===a.gameOverWinner?"text-blue-600":"text-red-600"}`,children:a.gameOverWinner.toUpperCase()})]})]})]},a.id)})})]})}),!c&&(0,d.jsx)("div",{className:"w-full",children:(0,d.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${U}, 1fr)`},children:F.map(c=>{N(c.id);let e="person-vs-ai"===c.gameType,f=2*a2.width*.45,g=2*a2.height*.45,h=A===c.id;return(0,d.jsxs)("div",{className:`border rounded p-2 bg-gray-50 relative flex flex-col items-center ${h?"border-blue-600 border-2":"border-gray-300"}`,style:{height:`${g+60}px`,minHeight:`${g+60}px`,maxHeight:`${g+60}px`,overflow:"hidden"},children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1 w-full",style:{width:`${f}px`},children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)("span",{className:"text-xs font-bold text-gray-700",children:["ID: ",c.id+1]}),(0,d.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-700 rounded font-medium",children:["Game ",c.episodeNumber," / ",(H.stats?.episode||0)+4]})]}),!e&&(0,d.jsx)("div",{className:"relative",children:(0,d.jsx)("button",{onClick:()=>{var a;(null===A||A===c.id)&&(a=c.id,null!==A&&A!==a&&O(A),B(a),G(b=>b.map(b=>b.id===a?{...b,gameType:"person-vs-ai"}:b)))},className:`text-xs px-2 py-1 rounded font-medium transition-colors ${!H.isTraining||null!==A&&A!==c.id?"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60":"bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer"}`,disabled:!H.isTraining||null!==A&&A!==c.id,children:A===c.id?"You are playing":"Join Game"})}),e&&(0,d.jsx)("button",{onClick:()=>O(c.id),className:"text-xs px-2 py-1 bg-orange-200 text-orange-700 rounded hover:bg-orange-300 font-medium",children:"Make AI vs AI"})]}),!H.isTraining&&(0,d.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 rounded",children:(0,d.jsx)("div",{className:"text-white text-sm",children:"Training paused"})}),(0,d.jsx)("div",{className:"flex justify-center items-center overflow-hidden",style:{width:`${f}px`,height:`${g}px`},children:(0,d.jsx)(aS,{width:a2.width,height:a2.height,tanks:c.tanks,bullets:c.bullets,barriers:a,suns:b,isPaused:!H.isTraining,tankImages:K,gameOverWinner:c.gameOverWinner,scale:.45})})]},c.id)})})}),c&&(0,d.jsxs)("div",{className:"w-full p-8 bg-gray-100 border border-gray-300 rounded text-center",children:[(0,d.jsx)("div",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Headless Training Mode Active"}),(0,d.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["Running ",I," games simultaneously (no rendering for better performance)"]}),(0,d.jsxs)("div",{className:"text-sm text-gray-600",children:["Auto-save: ",g>0?`${g} model(s) saved`:"Waiting for first save..."]})]})]})}let a4={width:(c=n(f.default,function(a){return!!h(a)&&m(a,"width",i)&&m(a,"height",i)&&m(a,"barriers",a=>j(a))&&m(a,"spawnPoints",a=>j(a))&&(!("suns"in a)||m(a,"suns",a=>j(a)))},"Invalid map data structure: missing or invalid required properties")).width,height:c.height,barriers:c.barriers,spawnPoints:c.spawnPoints,suns:c.suns||[]};function a5({onBack:a}){let b=a4.barriers||[],c=[],[f,g]=(0,e.useState)(!1),[h,i]=(0,e.useState)(!1),[j,k]=(0,e.useState)(null),[l,m]=(0,e.useState)(null),[n,o]=(0,e.useState)(()=>ax(a4,b,c)),[r,s]=(0,e.useState)([]),[t,u]=(0,e.useState)({blue:0,red:0}),[v,w]=(0,e.useState)(null),[x,y]=(0,e.useState)(!1),[z,A]=(0,e.useState)([]),[B,C]=(0,e.useState)(null),[D,E]=(0,e.useState)(null),[F,G]=(0,e.useState)(!1),[H,I]=(0,e.useState)(null),J=q(),K=p({gameOver:null!==v}),L=(0,e.useCallback)(async()=>{g(!0),k(null),i(!1);try{let a=l;if(!a){let b=new aZ(aY);await b.initialize(),m(b),a=b;let c=new aI({name:"TankTroubleRL",type:"discrete",observationSize:aY.observationSize,actionSize:aY.actionSize}),d={isLoaded:()=>!0,load:async b=>{a&&await a.load(b)},getInfo:()=>c.getInfo(),agent:a,predict:async(b,c)=>{if(!a)return console.warn("Agent not initialized, returning default decision"),{angleDelta:0,moveDirection:0,shouldShoot:!1};try{return await a.predict(b,c)}catch(a){return console.error("Error in agent predict:",a),{angleDelta:0,moveDirection:0,shouldShoot:!1}}}};aJ.setModel(d)}if(!a)throw Error("Failed to initialize DQN agent");let b=await fetch("/api/backend/models/latest");if(!b.ok){let a=await b.json().catch(()=>({error:"Unknown error"}));throw Error(a.error||`Failed to fetch model: ${b.statusText}`)}let c=await b.json();console.log("Model data received from Supabase:",{layersCount:c.layers?.length||0,hasMetadata:!!c.metadata,metadata:c.metadata});let d=c.layers.map((a,b)=>{let c=a.weights||a.Weights||[],d=a.biases||a.Biases||[],e=c.filter(a=>Math.abs(a)>1e-10).length,f=d.filter(a=>Math.abs(a)>1e-10).length,g=c.length,h=d.length,i=c.slice(0,10),j=d.slice(0,5);return console.log(`Layer ${b}:`,{weightsCount:g,biasesCount:h,nonZeroWeights:e,nonZeroBiases:f,weightSample:i,biasSample:j,allZeros:0===e&&0===f}),{weights:c,biases:d}});await a.loadWeightsFromJSON(d);let e={vector:Array(aY.observationSize).fill(.5),size:aY.observationSize};try{let b=await a.selectAction(e,!1);console.log("Model verification - test action:",b,"(should be 0-",aY.actionSize-1,")");let c=await a.predict(e,0);console.log("Model verification - test decision:",c)}catch(a){console.error("Model verification failed:",a)}i(!0),console.log("Successfully loaded latest model from Supabase",c.metadata)}catch(a){console.error("Failed to load model from Supabase:",a),k(a instanceof Error?a.message:String(a)),i(!1)}finally{g(!1)}},[l]);(0,e.useEffect)(()=>{L()},[L]);let M=(0,e.useCallback)(async()=>{if(0!==z.length){G(!0),I(null);try{let a=await fetch("http://localhost:8080/api/demonstrations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({steps:z,isDefault:!0,metadata:{episodeLength:z.length,totalReward:0,timestamp:new Date().toISOString()}})});if(!a.ok){let b=await a.text();throw Error(`Failed to save: ${a.status} ${b}`)}let b=await a.json();I(` Saved ${b.steps} demonstration steps`),A([]),C(null),E(null)}catch(b){let a=b instanceof Error?b.message:String(b);I(` Failed to save: ${a}`),console.error("Failed to save demonstrations:",b)}finally{G(!1)}}},[z]),N=(0,e.useCallback)(()=>{null!==v&&z.length>0&&M(),o(ax(a4,b,c)),s([]),u({blue:0,red:0}),w(null),y(!1),C(null),E(null)},[a4,b,c,v,z,M]),O=aR({mapData:a4,barriers:b,suns:c,aiConfig:aL,trainingManager:null,maxEpisodeTimeMs:Number.MAX_SAFE_INTEGER,gameInstances:[(0,e.useMemo)(()=>({id:0,tanks:n,bullets:r,lastShotTimes:t,gameMode:"person-vs-ai",gameId:"play-ai-game",isPaused:x,speedMultiplier:1,episodeStartTime:Date.now(),keysRef:K.keysRef}),[n,r,t,x,K.keysRef])],onTanksUpdate:(a,b)=>{o(b),(b[0]?.lives<=0||b[1]?.lives<=0)&&w(b[0]?.lives<=0?"red":"blue")},onBulletsUpdate:(a,b)=>{s(b)},onLastShotTimesUpdate:(a,b)=>{u(b)},onGameOver:(a,b)=>{w(b)}});return(0,e.useEffect)(()=>{if(x||!h||null!==v||n.length<2)return;let a=n[0],d=n[1];if(!a||!d)return;let e=aE({aiTank:a,enemyTank:d,bullets:r,barriers:b,suns:c,mapWidth:a4.width,mapHeight:a4.height,tickTime:Date.now(),config:aL});if(B&&null!==D){let b=a.lives<=0||d.lives<=0,c={state:B.vector,action:D,reward:.1,nextState:e.vector,done:b};A(a=>[...a,c])}let f=function(a,b={rotateLeft:"arrowleft",rotateRight:"arrowright",moveForward:"arrowup",moveBackward:"arrowdown",shoot:" "}){let c=a.has(b.rotateLeft),d=a.has(b.rotateRight),e=a.has(b.moveForward),f=a.has(b.moveBackward);if(a.has(b.shoot)){if(e)return 10;if(f)return 11;if(c)return 8;else if(d)return 9;return 5}return e?c?6:d?7:3:f?c?12:d?13:4:c?1:2*!!d}(K.keysRef.current);C(e),E(f)},[n,r,b,c,K.keysRef,x,h,v,B,D,a4]),(0,e.useEffect)(()=>{null!==v&&z.length>0&&!F&&M()},[v,z.length,F,M]),(0,e.useEffect)(()=>{if(x||!h||null!==v)return;let a=Date.now(),b=async()=>{let c=Date.now();c-a>=W&&(await O.gameTick({skipIntervalCheck:!1}),a=c),requestAnimationFrame(b)},c=requestAnimationFrame(b);return()=>cancelAnimationFrame(c)},[x,h,v,O]),(0,e.useEffect)(()=>{let a=a=>{"Escape"===a.key&&y(a=>!a)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),(0,d.jsxs)("div",{className:"flex flex-col items-center gap-4 w-full p-4",children:[(0,d.jsxs)("div",{className:"w-full max-w-4xl flex items-center justify-between",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold",children:"Play Your AI"}),(0,d.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Back to Training"})]}),(0,d.jsxs)("div",{className:"w-full max-w-4xl p-4 bg-white border border-gray-300 rounded shadow",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("label",{className:"text-sm font-semibold",children:"AI Model:"}),f?(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Loading latest model from Supabase..."}):h?(0,d.jsx)("span",{className:"text-sm text-green-600",children:" Latest model loaded from Supabase"}):j?(0,d.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,d.jsx)("span",{className:"text-sm text-red-600",children:" Failed to load model"}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:j}),(0,d.jsx)("button",{onClick:L,className:"mt-2 px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}):(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Ready to load"})]}),(0,d.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("label",{className:"text-sm font-semibold",children:"Demonstration Collection:"}),z.length>0?(0,d.jsxs)("span",{className:"text-sm text-blue-600",children:[" ",z.length," steps collected"]}):(0,d.jsx)("span",{className:"text-sm text-gray-500",children:"Not collecting"}),F&&(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Saving..."}),H&&(0,d.jsx)("span",{className:`text-sm ${H.startsWith("")?"text-green-600":"text-red-600"}`,children:H})]})})]}),(0,d.jsx)("div",{className:"w-full max-w-4xl p-4 bg-white border border-gray-300 rounded shadow",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"You (Blue): "}),(0,d.jsxs)("span",{className:"font-semibold text-blue-600",children:[n[0]?.lives??0," lives"]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"AI (Red): "}),(0,d.jsxs)("span",{className:"font-semibold text-red-600",children:[n[1]?.lives??0," lives"]})]})]}),x&&(0,d.jsx)("div",{className:"text-lg font-semibold text-gray-600",children:"PAUSED (Press ESC to resume)"}),v&&(0,d.jsx)("div",{className:"text-lg font-semibold",children:"blue"===v?(0,d.jsx)("span",{className:"text-blue-600",children:"You Win!"}):(0,d.jsx)("span",{className:"text-red-600",children:"AI Wins!"})})]})}),h?(0,d.jsx)("div",{className:"flex justify-center",children:(0,d.jsx)(aS,{width:a4.width,height:a4.height,tanks:n,bullets:r,barriers:b,suns:c,isPaused:x,tankImages:J,gameOverWinner:v,scale:1})}):(0,d.jsx)("div",{className:"w-full max-w-4xl p-8 bg-gray-100 border border-gray-300 rounded text-center",children:(0,d.jsx)("div",{className:"text-lg text-gray-600",children:f?"Loading model from Supabase...":"Waiting for AI model to load from Supabase"})}),(0,d.jsx)("div",{className:"w-full max-w-4xl p-4 bg-white border border-gray-300 rounded shadow",children:(0,d.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,d.jsx)("div",{className:"font-semibold mb-2",children:"Controls:"}),(0,d.jsx)("div",{children:"Player 1 (Blue - You): Arrow keys to move, Space to shoot"}),(0,d.jsx)("div",{children:"Press ESC to pause/resume"}),v&&(0,d.jsx)("button",{onClick:N,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Play Again"})]})})]})}function a6({view:a,onViewChange:b}){return"play"===a?(0,d.jsx)(a5,{onBack:()=>b("training")}):(0,d.jsx)(a3,{})}a.s(["default",()=>a6],50602)}];

//# sourceMappingURL=website_app_games_tank-trouble_page_tsx_fc963625._.js.map